#!/bin/bash

# ============================================================
# Полное удаление каталога build, если он существует.
# -r — рекурсивное удаление
# -f — принудительное удаление без подтверждения
# Это гарантирует «чистую» сборку без мусора.
# ============================================================
rm -rf build

# ============================================================
# Создание новой пустой директории build.
# В неё будет выполняться out-of-source сборка.
# ============================================================
mkdir -p build

# ============================================================
# Переход в только что созданную директорию build.
# Все дальнейшие команды будут выполняться внутри неё.
# ============================================================
cd build

# ============================================================
# Генерация файлов сборки с помощью CMake.
# ".." указывает на корень проекта, где лежит CMakeLists.txt.
# ============================================================
cmake ..

# ============================================================
# Непосредственная сборка проекта.
# Точка означает «собирать текущую директорию».
# ============================================================
cmake --build .

# ============================================================
# Запуск тестов через CTest.
# --output-on-failure выводит подробности только при ошибках,
# что делает лог чище, но информативным.
# ============================================================
ctest --output-on-failure

# ============================================================
# Запуск конкретного тестового бинарника.
# Путь ./tests/sn_tests предполагает, что CMake
# положил тесты в подпапку tests внутри build.
# В Linux исполняемые файлы обычно без расширения .exe
# ============================================================
./tests/sn_tests --verbose --show_progress