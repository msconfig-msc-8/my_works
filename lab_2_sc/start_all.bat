@echo off

REM ============================================================
REM  Полное удаление каталога build, если он существует.
REM  /s — удалить все вложенные файлы и папки.
REM  /q — тихий режим, без подтверждений.
REM  Это гарантирует «чистую» сборку без мусора.
REM ============================================================
rmdir /s /q build

REM ============================================================
REM  Создание новой пустой директории build.
REM  В неё будет выполняться out-of-source сборка.
REM ============================================================
mkdir build

REM ============================================================
REM  Переход в только что созданную директорию build.
REM  Все дальнейшие команды будут выполняться внутри неё.
REM ============================================================
cd build

REM ============================================================
REM  Генерация файлов сборки с помощью CMake.
REM  ".." указывает на корень проекта, где лежит CMakeLists.txt.
REM ============================================================
cmake ..

REM ============================================================
REM  Непосредственная сборка проекта.
REM  Точка означает «собирать текущую директорию».
REM  CMake сам выберет правильный генератор (MSVC, Ninja и т.д.).
REM ============================================================
cmake --build .

REM ============================================================
REM  Запуск тестов через CTest.
REM  --output-on-failure выводит подробности только при ошибках,
REM  что делает лог чище, но информативным.
REM ============================================================
ctest --output-on-failure

REM ============================================================
REM  Запуск конкретного тестового бинарника.
REM  Путь .\tests\sn_tests.exe предполагает, что CMake
REM  положил тесты в подпапку tests внутри build.
REM ============================================================
.\tests\sn_tests.exe
